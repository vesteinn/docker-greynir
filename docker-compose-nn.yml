version: '3'
services:
  modelserver:
    image: tensorflow/serving
    ports:
      - 8500:8500
      - 8501:8501
    volumes:
      - ./conf/models:/models
    command: tensorflow_model_server --port=8500 --rest_api_port=8501 --model_config_file=/models/models.conf
    depends_on:
      - greynir
  nnserver:
    image: nnserver
    ports:
      - 5005:5000
    environment:
      - MS_HOST=modelserver
      - MS_PORT=8501
    depends_on:
      - modelserver
    volumes:
      - /Users/vesteinnsnaebjarnarson/Work/mideind/nntrainer/nnserver:/nnserver
  greynir:
    environment:
      - NN_TRANSLATE_HOST=nnserver
      - NN_TRANSLATE_PORT=5000
      - NN_TRANSLATE_ENABLED=1
      - NN_PARSING_HOST=nnserver
      - NN_PARSING_PORT=5000
      - NN_PARSING_ENABLED=1
